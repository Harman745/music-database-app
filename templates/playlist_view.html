{% extends "base.html" %}

{% block title %}{{ playlist['playlist_name'] }} - Playlist{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ playlist['playlist_name'] }}</h1>
    <p>Created: {{ playlist['created_date'][:10] }}</p>
    <p>{{ track_count }} tracks • {{ total_duration }} sec total</p>

    <form action="{{ url_for('delete_playlist', playlist_id=playlist['playlist_id']) }}" method="POST" style="margin-bottom: 15px;">
        <button type="submit" class="btn-danger">Delete Playlist</button>
    </form>

    <button onclick="document.getElementById('renameBox').style.display='block'" class="btn-primary" style="margin-bottom: 20px;">
        Rename Playlist
    </button>

    <div id="renameBox" style="display:none; margin-bottom:20px;">
        <form action="{{ url_for('rename_playlist', playlist_id=playlist['playlist_id']) }}" method="POST">
            <input type="text" name="new_name" placeholder="New playlist name" required>
            <button type="submit" class="btn-primary">Save</button>
            <button type="button" class="btn-secondary" onclick="document.getElementById('renameBox').style.display='none'">Cancel</button>
        </form>
    </div>

    <h3>Add Track to Playlist</h3>
    <form action="{{ url_for('add_track_to_playlist', playlist_id=playlist['playlist_id']) }}" method="POST" style="margin-bottom: 20px;">
        <select name="track_id" required>
            <option value="">Select a track</option>
            {% for track in all_tracks %}
                <option value="{{ track['track_id'] }}">{{ track['track_title'] }} — {{ track['artist_name'] }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn-primary">Add</button>
    </form>

    {% if tracks %}
        <ul class="track-list">
            {% for track in tracks %}
            <li>
                <strong>{{ track['track_title'] }}</strong>
                <span>by {{ track['artist_name'] }}</span>
                <span>({{ track['duration_seconds'] }} sec)</span>

                <form action="{{ url_for('remove_track', playlist_id=playlist['playlist_id'], track_id=track['track_id']) }}" method="POST" style="display:inline;">
                    <button type="submit" class="btn-danger">Remove</button>
                </form>
            </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No tracks in this playlist yet.</p>
    {% endif %}

    <a href="{{ url_for('library') }}" class="btn-secondary">Back to Library</a>
</div>
{% endblock %}